{% extends 'base.html.twig' %}

{% block title %}Annonces {% endblock %}

{% block body %}
 <div class="container is-full-widescreen">
     {% for annonce in listAnnonces %}
     <div class="column">
         <div class="card">
             <div class="card-image">
                 <figure class="image is-4by3">
                     <img src="{{ asset('imgAnnonce/DSC_9358.jpg') }}" alt="Placeholder image">
                 </figure>
             </div>
             <div class="card-content">
                 <div class="media">
                     <div class="media-content">
                         <p class="title is-4">{{ annonce.titre }}</p>
                         <p class="subtitle is-6">{{ annonce.prix }} €</p>
                         <a href="{{ path('fav', {'idannonce': annonce.idannonce}) }}" class="button is-text js-like">
                             {% if app.user and annonce.isLikedByUser(app.user) %}
                             <i class="fa-solid fa-heart js-like"></i>
                             <span>Enlever de mes favoris</span>
                             {% else %}
                             <i class="fa-regular fa-heart js_like"></i>
                             <span>Ajouter à mes favoris</span>
                             <br>
                         </a>
                         {% endif %}
                     </div>
                 </div>
                 <div class="content">
                     <a href="{{ path('app_annonce_show', {'idannonce': annonce.idannonce}) }}"><button type="button" class="button is-fullwidth is-primary is-light">En savoir plus</button></a>
                     <br>
                     <time datetime="2016-1-1">Annonce postée le {{ annonce.dateCreation|date("d/m/Y") }}</time>
                 </div>
             </div>
         </div>
     </div>
     {% endfor %}
     <a href="{{ path('homepage') }}" style="color:black;"> Retour au menu </a>
 </div>
    <script>
        function onClickBtnLike(event){
            event.preventDefault();

            const url = this.href;
            const spanCount = this.querySelector('span.js-likes');
            const icone = this.querySelector('i');
            axios.get(url).then(function (response){
                let favoris = response.data.favoris;
                if(icone.classList.contains('fa-regular')) {
                    icone.classList.replace('fa-regular', 'fa-solid');
                }
                else{
                    icone.classList.replace('fa-solid', 'fa-regular');
                }
            });
        }
        document.querySelectorAll('a.js-like').forEach(function (link){
            link.addEventListener('click',onClickBtnLike)

        })
    </script>
{% endblock %}
